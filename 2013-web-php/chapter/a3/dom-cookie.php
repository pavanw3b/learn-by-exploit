<?php
	setcookie('visitor_name', $_POST['visitor_name']);
?>
<!DOCTYPE html>
<html lang="en">
<head>
	<?php require_once('../../include/head-include.php'); ?>
	<title>DOM Cookie based | XSS | LearnByExploit</title>
</head>
<body>
	<!-- wrapper -->
	<div class="wrapper">
		<?php require_once('../../include/header.php'); ?>
		<!-- shell -->
		<div class="shell">
			<!-- main -->
			<div class="main">
				<section class="content">
					<h3><i>Note:</i> Chrome's XSS audior blocks your payload. Switch to firefox for successful exploit.</h3>
					<script>
						var visitor_name = getCookie('visitor_name');
						if(visitor_name != null) {
							document.write('Welcome ' + visitor_name);
						} else {
							document.write('<h3>What&rsquo;s your name?</h3><form method="POST"><p>Name: <input type="text" name="visitor_name" />&nbsp; <input type="submit" value=" Go " /></p></form>');
						}
					</script>
					<button onclick="refresh();">Clear</button>
					<hr />
					<h3>Background</h3>
					<p>The application accepts the name sets it to cookie. The same value is echoed into HTTP Response later.</p>
					<pre>
&lt;?php
setcookie('visitor_name', $_POST['visitor_name']);
?&gt;
..
..
&lt;script&gt;
var visitor_name = getCookie('visitor_name');
document.write('Welcome ' + visitor_name);
&lt;/script&gt;
			</pre>
					<h3>Solution</h3>
					<p>
						Enter <i>1337&lt;script&gt;alert('xssed');&lt;/script&gt;</i>
					</p>
					<p>
						Using universal truth in both parameters:<br />
						Username: email=aa' or 'a'='a<br />
						password=aa' or 'a'='a
					</p>
				</section>
			</div>
			<!-- end of main -->
		</div>
		<script>
			function refresh() {
				var cookies = document.cookie.split(";");
			    for (var i = 0; i < cookies.length; i++) {
			    	var cookie = cookies[i];
			    	var eqPos = cookie.indexOf("=");
			    	var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
			    	document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
			    }
			    location.reload();
			}
		</script>
		<!-- end of shell -->	
		<?php require_once('../../include/footer.php'); ?>
	</div>
	<!-- end of wrapper -->
</body>
</html>