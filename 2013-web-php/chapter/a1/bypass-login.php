<?php
if(isset($_POST['submit'])) {
	$isAuthenticated = False;
	require_once('../../config/database.php');
	$con = mysqli_connect($host, $user, $password, $database, $port, $socket) or die("Database Connection error.<br />Please review the settings under /config/database.php<br />The current settings are<br />host: ".$host."<br />user: ".$user."<br />password: ".$password.'<br />db: '.$database.'<br />port: '.$port.'<br />socket: '.$socket);
	$email = $_POST['email'];
	$password = $_POST['password'];
	$query = "SELECT user_id FROM victim_user WHERE email = '".$email."' AND password = '".$password."'";
	$result = mysqli_query($con, $query) or die(mysqli_error($con)."<br />The query is<br />".$query);
	if(0 < $result->num_rows)
		$isAuthenticated = True;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
	<?php require_once('../../include/head-include.php'); ?>
	<title>By-pass Authentication | SQLi LearByExploit</title>
</head>
<body>
	<!-- wrapper -->
	<div class="wrapper">
		<?php require_once('../../include/header.php'); ?>
		<!-- shell -->
		<div class="shell">
			<!-- main -->
			<div class="main">
				<section class="content">
					<h3>Challenge:</h3>
					<p>Try to by-pass the authentication without using valid credentials, but SQL Injection.</p>
					<?php if(!$isAuthenticated) { ?>
						<form method="POST">
							<input type="text" name="email" placeholder="foo@example.com" />
							<input type="password" placeholder="password@123" name="password" />
							<input type="submit" value=" Login " name="submit" />
						</form>
					<?php
					}
					?>
					<?php
						if(isset($_POST['submit'])) {
							if($isAuthenticated)
								echo "Authentication success";
							else
								echo "Authentication failed! Try foo@example.com &amp; password@123";
							echo "<br /><br />";
							echo "The query was: ".$query;
							
						}
					?>
					<hr />
					<h3>Background</h3>
					<p>The entered credentials are put dynamically in a SELECT query like below and checks if it returns more than one query.</p>
					<pre>
$email = $_POST['email'];
$password = $_POST['password'];
$query = "SELECT user_id FROM victim_user WHERE email = '".$email."' AND password = '".$password."'";
			</pre>
					<h3>Solution</h3>
					<p>
						Using universal truth &amp; only one parameter:<br />
						Username: aa' or 'a'='a'#<br />
						Password: anything
					</p>
						Using universal truth in both parameters:<br />
						Username: email=aa' or 'a'='a<br />
						password=aa' or 'a'='a
					</p>
				</section>
			</div>
			<!-- end of main -->
		</div>
		<!-- end of shell -->	
		<?php require_once('../../include/footer.php'); ?>
	</div>
	<!-- end of wrapper -->
</body>
</html>