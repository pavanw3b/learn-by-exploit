<?php
	if(isset($_POST['comment'])) {
		$file = 'comments.php';
		$comment = $_POST['comment']."<br />Posted at: ".date('Y-m-d h:i:sa')."<br /><br />";
		
		$current = file_get_contents($file);
		$current .= $comment;

		file_put_contents($file, $current);
	}
?>	
<!DOCTYPE html>
<html lang="en">
<head>
	<?php require_once('../../include/head-include.php'); ?>
	<title>Comment - Code Injection RCE | Learn by Exploit</title>
</head>
<body>
	<!-- wrapper -->
	<div class="wrapper">
		<?php require_once('../../include/header.php'); ?>
		<!-- shell -->
		<div class="shell">
			<!-- main -->
			<div class="main">
				<section class="content">
					<h3>Commenting System</h3>
					<br />
					<!-- file contents of comments.php -->	
					<?php
						echo str_replace('&lt;br /&gt;', '<br />', htmlentities(file_get_contents('comments.php')));
					?>
					<h3>Add your comment:</h3>
					<form method="post">
						<table>
							<tr>
								<td><textarea name="comment" cols="60" rows="4"></textarea></td>
							</tr>
							<tr>
								<td><input type="submit" /></td>
							</tr>
						</table>
					</form>

					<h3>Challenge</h3>
					<p>Try to inject arbitrary server side code. Probably phpinfo().</p>
					<hr />
					<h3>Solution</h3>
					<p>phpinfo(): <i>Some comments.&lt;br /&gt;&lt;?php phpinfo(); ?&gt;&lt;br /&gt;</i></p>
				</section>
			</div>
			<!-- end of main -->
		</div>
		<!-- end of shell -->	
		<?php require_once('../../include/footer.php'); ?>
	</div>
	<!-- end of wrapper -->
</body>
</html>