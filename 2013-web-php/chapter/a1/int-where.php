<?php

if(isset($_GET['user_id'])) {
	require_once('../../config/database.php');
	$con = mysqli_connect($host, $user, $password, $database, $port, $socket) or die("Database Connection error.<br />Please review the settings under /config/database.php<br />The current settings are<br />host: ".$host."<br />user: ".$user."<br />password: ".$password.'<br />db: '.$database.'<br />port: '.$port.'<br />socket: '.$socket);
	$user_id = $_GET['user_id'];
	$isFound = False;
	$query = "SELECT email, password FROM user WHERE user_id = $user_id";
	$result = mysqli_query($con, $query) or die("Error in query<br />".mysqli_error($con)."<br />The query is<br />".$query);
}

?>
<!DOCTYPE html>
<html lang="en">
<head>
	<?php require_once('../../include/head-include.php'); ?>
	<title>Integer - Where | SQLi | LearnByExploit</title>
</head>
<body>
	<!-- wrapper -->
	<div class="wrapper">
		<?php require_once('../../include/header.php'); ?>
		<!-- shell -->
		<div class="shell">
			<!-- main -->
			<div class="main">
				<section class="content">
					<h3>Challenge</h3>
					<p>The form list Users by user id. Enter 1, for example.</p>
					<p>SQL Inject the integer field to find number of columns returned by the query, database name, version, mysql directory etc.</p>
					<?php 
					if(isset($_GET['user_id'])) {
						if(0 < $result->num_rows) {
							echo "<table border=\"1\"><tr><td>User Id</td><td>Email</td><td>Password</td></tr>";
							while($row = $result->fetch_assoc()) {
								echo "<tr><td>".$_GET['user_id']."</td><td>".$row['email']."</td><td>".$row['password']."</td></tr>";
							}
							echo "</table>";
						}
						else{
							echo "No User record found. Please enter 1.";
						}
						echo "<br /><b>The query: </b>";
						echo $query;
					}
					else {
					?>
						<form>
							<input type="text" name="user_id" value="1" />
							<input type="submit" value=" Login " />
						</form>
					<?php
					}
					?>
					<?php
						if(isset($_POST['submit'])) {
							echo "The query was: ".$query;
						}
						echo "<br />";
					?>
					<br />
					<hr />
					<h3>Background</h3>
					<p></p>
					<pre>
$user_id = $_POST['user_id'];
$query = "SELECT email FROM user WHERE user_id = ".$user_id;
			</pre>
					<h3>Solution</h3>
					<p><b>Number of Columns returned:</b>:<br />
						Answer: There are 2 columns selected by the query..<br />
						"1 order by 2" doesn't give error, but "1 order by 3".
					</p>
					<p><b>DB Version, MySQL data directory</b>:<br />
						Enter "0 union select @@version, @@datadir;".
					</p>
				</section>
			</div>
			<!-- end of main -->
		</div>
		<!-- end of shell -->	
		<?php require_once('../../include/footer.php'); ?>
	</div>
	<!-- end of wrapper -->
</body>
</html>